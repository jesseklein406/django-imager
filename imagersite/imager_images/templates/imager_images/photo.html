{% extends "base.html" %}
{% load images_filters %}
{% load staticfiles %}

{% block css %}
  {{ block.super }}
  <link rel='stylesheet' type='text/css' href="{% static 'css/facetagger.css' %}"/>
  <link rel="stylesheet" type='text/css' href="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.0/sweetalert.min.css"/>
{% endblock %}

{% block nav %}
<nav id="navbar-collapse" class="collapse u-pull-left">
  <ul class="u-cf">
    <li><a href="{% url 'profile:detail' %}">Profile</a></li>
    <li><a href="{% url 'library' %}">Library</a></li>
  </ul>
</nav>
{% endblock %}

{% block content %}
    {% if photo|photo_is_authorized:user %}
    <div class="main">
        <div id="photo-container">
          <img src="{{ photo.photo.url }}">
        </div>
        <h3>{{ photo.title }}</h3>
        <h4>{{ photo.user }}</h4>
        <p>{{ photo.description }}</p>
        <p>Date Uploaded: {{ photo.date_uploaded }}</p>
        <p>Date Modified: {{ photo.date_modified }}</p>
        {% if not faces %}
        <a href="{% url 'detect_faces' object.id %}"><button>Detect Faces</button></a>
        {% endif %}
    </div>
    {% else %}
    <p>Not found</p>
    {% endif %}
    
{% endblock %}

{% block script %}
  {{ block.super }}
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <script type="text/javascript" src="//algorithmia.com/v1/clients/js/algorithmia-0.2.0.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.0.1/sweetalert-dev.js"></script>
  <script src="{% static 'js/facetagger.js' %}"  type="text/javascript"></script>
  <script type="text/javascript">
    FaceTagger.init({
      container: '#photo-container',
      labelUrl: '{% url "edit_face" object.id %}',
      csrf: '{{ csrf_token }}',
      originalWidth: {{ object.photo.width }},
      originalHeight: {{ object.photo.height }},
    newWidth: $("#photo-container img").width(),
    newHeight: $("#photo-container img").height()
    });
    {% for f in faces %}
      var face = {
        id: {{ f.id }},
        name: "{{ f.name }}",
        x: {{ f.x }},
        y: {{ f.y }},
        width: {{ f.width }},
        height: {{ f.height }}
      };
      FaceTagger.make(face);
    {% endfor %}
  </script>
{% endblock %}
